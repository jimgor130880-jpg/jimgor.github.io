<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯•è¯•ä½ çš„è¿æ°” | å¹¸è¿å¤§æŠ½å¥–</title>
    <style>
        body {
            background-color: #1E4198;
            margin: 0;
            padding: 10px; /* ç¼©å°å†…è¾¹è· */
            font-family: Arial, sans-serif;
            position: relative;
            min-height: 100vh;
            box-sizing: border-box;
        }
        /* æ–°å¢è¯­è¨€åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .language-switcher {
            position: absolute;
            top: 10px; /* ç¼©å°é¡¶éƒ¨é—´è· */
            right: 10px; /* ç¼©å°å³ä¾§é—´è· */
            z-index: 100;
        }
        .lang-btn {
            background-color: #FFC100;
            color: #000;
            border: none;
            padding: 6px 12px; /* ç¼©å°æŒ‰é’®å†…è¾¹è· */
            border-radius: 4px; /* ç¼©å°åœ†è§’ */
            margin-left: 4px; /* ç¼©å°æŒ‰é’®é—´è· */
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            font-family: Arial, "Times New Roman", serif;
            font-size: 12px; /* ç¼©å°å­—ä½“ */
        }
        .lang-btn:hover {
            background-color: #FFD700;
            transform: scale(1.05);
        }
        .lang-btn.active {
            background-color: #E62E2E;
            color: #FFD900;
        }
        .header {
            text-align: center;
            margin-bottom: 15px; /* ç¼©å°åº•éƒ¨é—´è· */
            padding-top: 30px; /* ç¼©å°é¡¶éƒ¨å†…è¾¹è· */
        }
        .title {
            background-color: #E62E2E;
            color: #FFD900;
            font-size: 20px; /* ç¼©å°æ ‡é¢˜å­—ä½“ */
            font-weight: bold;
            padding: 8px 20px; /* ç¼©å°å†…è¾¹è· */
            border-radius: 4px; /* ç¼©å°åœ†è§’ */
            display: inline-block;
            margin: 0;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 90px); /* ç¼©å°æ ¼å­å®½åº¦ */
            grid-template-rows: repeat(7, 50px); /* ç¼©å°æ ¼å­é«˜åº¦ */
            gap: 8px; /* ç¼©å°æ ¼å­é—´è· */
            justify-content: center;
        }
        .grid-item {
            background-color: #E62E2E;
            color: #FFD900;
            font-size: 22px; /* ç¼©å°é—®å·å­—ä½“ */
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 4px; /* ç¼©å°åœ†è§’ */
            position: relative;
            padding: 3px 0; /* ç¼©å°å†…è¾¹è· */
            cursor: default;
            transition: all 0.15s ease;
            box-sizing: border-box;
            text-align: center;
        }
        .empty {
            background-color: transparent;
        }
        .start-btn {
            background-color: #FFC100;
            color: #000;
            font-size: 18px; /* ç¼©å°æŒ‰é’®å­—ä½“ */
            font-weight: bold;
            padding: 8px 70px; /* ç¼©å°æŒ‰é’®å†…è¾¹è· */
            border: none;
            border-radius: 4px; /* ç¼©å°åœ†è§’ */
            margin-top: 15px; /* ç¼©å°é¡¶éƒ¨é—´è· */
            cursor: pointer;
            transition: all 0.2s;
        }
        .start-btn:disabled {
            background-color: #999;
            color: #666;
            cursor: not-allowed;
            transform: scale(1);
        }
        .start-btn:hover:not(:disabled) {
            background-color: #FFD700;
            transform: scale(1.02);
        }
        .btn-container {
            text-align: center;
        }
        .icon {
            width: 15px; /* ç¼©å°è£…é¥°å›¾æ ‡ */
            height: 15px; /* ç¼©å°è£…é¥°å›¾æ ‡ */
            background-color: #FFC100;
            border-radius: 50% 50% 50% 0;
            position: absolute;
        }
        .icon-left { top: 120px; left: 10px; } /* è°ƒæ•´è£…é¥°å›¾æ ‡ä½ç½® */
        .icon-right { top: 200px; right: 10px; } /* è°ƒæ•´è£…é¥°å›¾æ ‡ä½ç½® */
        .star {
            color: #fff;
            position: absolute;
            font-size: 14px; /* ç¼©å°æ˜Ÿæ˜Ÿå­—ä½“ */
        }
        .star1 { top: 60px; left: 10px; } /* è°ƒæ•´æ˜Ÿæ˜Ÿä½ç½® */
        .star2 { bottom: 40px; right: 10px; } /* è°ƒæ•´æ˜Ÿæ˜Ÿä½ç½® */
        .star3 { bottom: 15px; left: 10px; } /* è°ƒæ•´æ˜Ÿæ˜Ÿä½ç½® */
        .star4 { right: 10px; top: 300px; } /* è°ƒæ•´æ˜Ÿæ˜Ÿä½ç½® */
        /* æ»šåŠ¨é«˜äº®æ ·å¼ */
        .grid-item.active {
            background-color: #FFD900;
            color: #E62E2E;
            transform: scale(1.05);
            box-shadow: 0 0 12px #FFD900; /* ç¼©å°é˜´å½± */
            z-index: 10;
        }
        /* ä¸­å¥–é«˜äº®+é—ªçƒæ ·å¼ï¼ˆæ»šåŠ¨åœæ­¢åï¼‰ */
        .grid-item.win {
            background-color: #FF0000;
            color: #FFFFFF;
            box-shadow: 0 0 15px #FF0000, 0 0 25px #FF0000; /* ç¼©å°é˜´å½± */
            transform: scale(1.05);
            z-index: 20;
        }
        /* ç¿»è½¬åç™½åº• + æ— é™æŒç»­é—ªçƒ */
        .grid-item.flipped {
            background-color: #FFFFFF !important;
            font-weight: bold;
            border-radius: 4px; /* ç¼©å°åœ†è§’ */
            transform: scale(1);
            z-index: 25;
            animation: flipFlash 1.2s ease-in-out infinite alternate;
        }
        /* ä¸åŒå¥–å“çš„æ–‡å­—é¢œè‰² */
        .color-black { color: #000000 !important; }
        .color-yellow { color: #FFD900 !important; }
        .color-orange { color: #FF7F00 !important; }
        .color-blue { color: #0066FF !important; }
        .color-red { color: #E62E2E !important; }
        /* æ´—ç‰Œå±•ç¤ºå¥–å“æ ·å¼ï¼ˆæ— æ— é™é—ªçƒï¼‰ */
        .grid-item.shuffle-show {
            background-color: #FFFFFF;
            font-weight: bold;
            border-radius: 4px; /* ç¼©å°åœ†è§’ */
            transform: scale(1);
            z-index: 25;
        }
        /* æ»šåŠ¨ä¸­å¥–é—ªçƒåŠ¨ç”» */
        @keyframes flashOnce {
            from { opacity: 1; transform: scale(1.05); }
            to { opacity: 0.5; transform: scale(1.12); }
        }
        /* ç¿»è½¬åæ°¸ä¹…æŒç»­é—ªçƒåŠ¨ç”» */
        @keyframes flipFlash {
            from { box-shadow: 0 0 8px #FFFFFF, 0 0 12px #E62E2E; /* ç¼©å°é˜´å½± */ opacity: 1; }
            to { box-shadow: 0 0 20px #FFFFFF, 0 0 30px #E62E2E; /* ç¼©å°é˜´å½± */ opacity: 0.95; }
        }
        /* ä¸­å¥–æ–‡å­—åˆ†è¡Œæ ·å¼ */
        .prize-text {
            font-size: 13px; /* ç¼©å°å¥–å“æ–‡å­— */
            line-height: 1.2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1px; /* ç¼©å°è¡Œé—´è· */
            width: 100%;
            padding: 0 3px; /* ç¼©å°å†…è¾¹è· */
        }
        .prize-top { font-size: 12px; /* ç¼©å°ä¸ŠåŠéƒ¨åˆ†æ–‡å­— */ }
        .prize-bottom { font-size: 14px; /* ç¼©å°ä¸‹åŠéƒ¨åˆ†æ–‡å­— */ font-weight: bold; }
    </style>
</head>
<body>
    <!-- æ–°å¢è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
    <div class="language-switcher">
        <button class="lang-btn active" id="cnBtn">ä¸­æ–‡</button>
        <button class="lang-btn" id="enBtn">English</button>
        <button class="lang-btn" id="arBtn">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    </div>
    
    <div class="icon icon-left"></div>
    <div class="icon icon-right"></div>
    <div class="star star1">â˜…</div>
    <div class="star star2">â˜…</div>
    <div class="star star3">â˜…</div>
    <div class="star star4">â˜…</div>
    
    <div class="header">
        <div class="title" id="mainTitle">è¯•è¯•ä½ çš„è¿æ°”</div>
    </div>

    <div class="grid-container">
        <div class="grid-item" data-num="1">ï¼Ÿ</div>
        <div class="grid-item" data-num="2">ï¼Ÿ</div>
        <div class="grid-item" data-num="3">ï¼Ÿ</div>
        <div class="grid-item" data-num="4">ï¼Ÿ</div>
        <div class="empty"></div>
        <div class="grid-item" data-num="5">ï¼Ÿ</div>
        <div class="grid-item" data-num="6">ï¼Ÿ</div>
        <div class="empty"></div>
        <div class="grid-item" data-num="7">ï¼Ÿ</div>
        <div class="grid-item" data-num="8">ï¼Ÿ</div>
        <div class="empty"></div>
        <div class="grid-item" data-num="9">ï¼Ÿ</div>
        <div class="grid-item" data-num="10">ï¼Ÿ</div>
        <div class="empty"></div>
        <div class="grid-item" data-num="11">ï¼Ÿ</div>
        <div class="grid-item" data-num="12">ï¼Ÿ</div>
        <div class="empty"></div>
        <div class="grid-item" data-num="13">ï¼Ÿ</div>
        <div class="grid-item" data-num="14">ï¼Ÿ</div>
        <div class="grid-item" data-num="15">ï¼Ÿ</div>
        <div class="grid-item" data-num="16">ï¼Ÿ</div>
    </div>

    <div class="btn-container">
        <button class="start-btn" id="startBtn">å¼€å§‹</button>
    </div>

    <script>
        // ========== âœ… è¯­è¨€é…ç½® ==========
        const langConfig = {
            cn: {
                title: "è¯•è¯•ä½ çš„è¿æ°”",
                startBtn: "å¼€å§‹",
                shuffleBtn: "æ´—ç‰Œ",
                prize100: "è·å¾—100ç²‰ä¸",
                prize1000: "è·å¾—1000ç²‰ä¸",
                prize5000: "è·å¾—5000ç²‰ä¸",
                prize10000: "è·å¾—10000ç²‰ä¸",
                prize100000: "è·å¾—100000ç²‰ä¸",
                prizeTop: "è·å¾—",
                prize100Bottom: "100ç²‰ä¸",
                prize1000Bottom: "1000ç²‰ä¸",
                prize5000Bottom: "5000ç²‰ä¸",
                prize10000Bottom: "10000ç²‰ä¸",
                prize100000Bottom: "100000ç²‰ä¸",
                unknown: "ï¼Ÿ",
                clearRecordAlert: "âœ… ä¸­å¥–è®°å½•åŠŸèƒ½å·²ç§»é™¤ï¼",
                checkProbabilityAlert: "æ¦‚ç‡éªŒè¯å®Œæˆï¼è¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼ˆæŒ‰F12æ‰“å¼€ï¼‰",
                checkProbabilityLog1: "æ¦‚ç‡éªŒè¯ç»“æœï¼ˆå…±",
                checkProbabilityLog2: "æ¬¡ï¼‰ï¼š",
                checkProbabilityLog3: "ç²‰ä¸ï¼š",
                checkProbabilityLog4: "æ¬¡ ("
            },
            en: {
                title: "Try Your Luck",
                startBtn: "Start",
                shuffleBtn: "Shuffle",
                prize100: "Win 100 Fans",
                prize1000: "Win 1000 Fans",
                prize5000: "Win 5000 Fans",
                prize10000: "Win 10000 Fans",
                prize100000: "Win 100000 Fans",
                prizeTop: "Win",
                prize100Bottom: "100 Fans",
                prize1000Bottom: "1000 Fans",
                prize5000Bottom: "5000 Fans",
                prize10000Bottom: "10000 Fans",
                prize100000Bottom: "100000 Fans",
                unknown: "?",
                clearRecordAlert: "âœ… Winning record function has been removed!",
                checkProbabilityAlert: "Probability verification completed! Please check console log (press F12 to open)",
                checkProbabilityLog1: "Probability verification result (total ",
                checkProbabilityLog2: " times):",
                checkProbabilityLog3: " Fans: ",
                checkProbabilityLog4: " times ("
            },
            ar: {
                title: "Ø¬Ø±Ø¨ Ø­Ø¸Ùƒ",
                startBtn: "Ø§Ø¨Ø¯Ø£",
                shuffleBtn: "Ø®Ù„Ø·",
                prize100: "ÙÙˆØ² 100 Ù…ØªØ§Ø¨Ø¹",
                prize1000: "ÙÙˆØ² 1000 Ù…ØªØ§Ø¨Ø¹",
                prize5000: "ÙÙˆØ² 5000 Ù…ØªØ§Ø¨Ø¹",
                prize10000: "ÙÙˆØ² 10000 Ù…ØªØ§Ø¨Ø¹",
                prize100000: "ÙÙˆØ² 100000 Ù…ØªØ§Ø¨Ø¹",
                prizeTop: "Ø§Ù„ÙÙˆØ²",
                prize100Bottom: "100 Ù…ØªØ§Ø¨Ø¹",
                prize1000Bottom: "1000 Ù…ØªØ§Ø¨Ø¹",
                prize5000Bottom: "5000 Ù…ØªØ§Ø¨Ø¹",
                prize10000Bottom: "10000 Ù…ØªØ§Ø¨Ø¹",
                prize100000Bottom: "100000 Ù…ØªØ§Ø¨Ø¹",
                unknown: "ØŸ",
                clearRecordAlert: "âœ… ØªÙ… Ø¥Ø²Ø§Ù„Ø© ÙˆØ¸ÙŠÙØ© Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ²!",
                checkProbabilityAlert: "ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ©! ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø³Ø¬Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ø¶ØºØ· F12 Ù„ÙØªØ­Ù‡)",
                checkProbabilityLog1: "Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© (Ù…Ø¬Ù…ÙˆØ¹ ",
                checkProbabilityLog2: " Ù…Ø±Ø©):",
                checkProbabilityLog3: " Ù…ØªØ§Ø¨Ø¹: ",
                checkProbabilityLog4: " Ù…Ø±Ø© ("
            }
        };
        
        // å½“å‰è¯­è¨€
        let currentLang = "cn";
        
        // ========== âœ… æ ¸å¿ƒé…ç½®é¡¹ ==========
        const luckyPath = [1,2,3,5,7,9,11,13,16,15,14,12,10,8,6,4,1]; // æ»šåŠ¨è½¨è¿¹
        const startBtn = document.getElementById('startBtn');
        const mainTitle = document.getElementById('mainTitle');
        const cnBtn = document.getElementById('cnBtn');
        const enBtn = document.getElementById('enBtn');
        const arBtn = document.getElementById('arBtn');
        let isRunning = false; // æŠ½å¥–çŠ¶æ€é”
        let isShuffleMode = false; // æ˜¯å¦ä¸ºæ´—ç‰Œæ¨¡å¼
        const FLASH_TIMES = 5; // æ»šåŠ¨ä¸­å¥–é—ªçƒæ¬¡æ•°
        const FLASH_INTERVAL = 180; // é—ªçƒé—´éš”(ms)
        const SHOW_PRIZE_TIME = 2000; // æ´—ç‰Œå±•ç¤ºå¥–å“æ—¶é•¿(ms)
        
        // âœ… å¥–å“æ¦‚ç‡é…ç½®ï¼ˆç²¾ç¡®æ§åˆ¶ï¼‰
        const PRIZE_PROBABILITY = {
            "è·å¾—100ç²‰ä¸": 80,    // 80%
            "è·å¾—1000ç²‰ä¸": 12,   // 12%
            "è·å¾—5000ç²‰ä¸": 6,    // 6%
            "è·å¾—10000ç²‰ä¸": 2,   // 2%
            "è·å¾—100000ç²‰ä¸": 0   // 0%
        };
        
        // âœ… å¥–å“åŸºç¡€é…ç½®ï¼ˆä»…ç”¨äºæ´—ç‰Œå±•ç¤ºï¼‰
        const prizeConfig = [
            "è·å¾—100ç²‰ä¸", "è·å¾—100ç²‰ä¸", "è·å¾—100ç²‰ä¸", "è·å¾—100ç²‰ä¸", "è·å¾—100ç²‰ä¸",
            "è·å¾—100ç²‰ä¸", "è·å¾—100ç²‰ä¸",
            "è·å¾—1000ç²‰ä¸", "è·å¾—1000ç²‰ä¸", "è·å¾—1000ç²‰ä¸", "è·å¾—1000ç²‰ä¸",
            "è·å¾—5000ç²‰ä¸", "è·å¾—5000ç²‰ä¸",
            "è·å¾—10000ç²‰ä¸", "è·å¾—10000ç²‰ä¸",
            "è·å¾—100000ç²‰ä¸"
        ];
        
        // å¥–å“åç§°æ˜ å°„
        const prizeMap = {
            cn: {
                "è·å¾—100ç²‰ä¸": "è·å¾—100ç²‰ä¸",
                "è·å¾—1000ç²‰ä¸": "è·å¾—1000ç²‰ä¸",
                "è·å¾—5000ç²‰ä¸": "è·å¾—5000ç²‰ä¸",
                "è·å¾—10000ç²‰ä¸": "è·å¾—10000ç²‰ä¸",
                "è·å¾—100000ç²‰ä¸": "è·å¾—100000ç²‰ä¸"
            },
            en: {
                "è·å¾—100ç²‰ä¸": "Win 100 Fans",
                "è·å¾—1000ç²‰ä¸": "Win 1000 Fans",
                "è·å¾—5000ç²‰ä¸": "Win 5000 Fans",
                "è·å¾—10000ç²‰ä¸": "Win 10000 Fans",
                "è·å¾—100000ç²‰ä¸": "Win 100000 Fans"
            },
            ar: {
                "è·å¾—100ç²‰ä¸": "ÙÙˆØ² 100 Ù…ØªØ§Ø¨Ø¹",
                "è·å¾—1000ç²‰ä¸": "ÙÙˆØ² 1000 Ù…ØªØ§Ø¨Ø¹",
                "è·å¾—5000ç²‰ä¸": "ÙÙˆØ² 5000 Ù…ØªØ§Ø¨Ø¹",
                "è·å¾—10000ç²‰ä¸": "ÙÙˆØ² 10000 Ù…ØªØ§Ø¨Ø¹",
                "è·å¾—100000ç²‰ä¸": "ÙÙˆØ² 100000 Ù…ØªØ§Ø¨Ø¹"
            }
        };
        
        // åå‘æ˜ å°„ï¼ˆç”¨äºæ¦‚ç‡ç»Ÿè®¡ï¼‰
        const reversePrizeMap = {
            "Win 100 Fans": "è·å¾—100ç²‰ä¸",
            "Win 1000 Fans": "è·å¾—1000ç²‰ä¸",
            "Win 5000 Fans": "è·å¾—5000ç²‰ä¸",
            "Win 10000 Fans": "è·å¾—10000ç²‰ä¸",
            "Win 100000 Fans": "è·å¾—100000ç²‰ä¸",
            "ÙÙˆØ² 100 Ù…ØªØ§Ø¨Ø¹": "è·å¾—100ç²‰ä¸",
            "ÙÙˆØ² 1000 Ù…ØªØ§Ø¨Ø¹": "è·å¾—1000ç²‰ä¸",
            "ÙÙˆØ² 5000 Ù…ØªØ§Ø¨Ø¹": "è·å¾—5000ç²‰ä¸",
            "ÙÙˆØ² 10000 Ù…ØªØ§Ø¨Ø¹": "è·å¾—10000ç²‰ä¸",
            "ÙÙˆØ² 100000 Ù…ØªØ§Ø¨Ø¹": "è·å¾—100000ç²‰ä¸"
        };
        
        // åˆå§‹åŒ–å¥–å“æ˜ å°„ï¼ˆéšæœºåˆ†é…ï¼Œä»…ç”¨äºæ´—ç‰Œå±•ç¤ºï¼‰
        let gridPrizeMap = {};
        initPrizeMap();

        // ========== è¯­è¨€åˆ‡æ¢åŠŸèƒ½ ==========
        function switchLanguage(lang) {
            if (lang === currentLang) return;
            
            currentLang = lang;
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            cnBtn.classList.toggle('active', lang === 'cn');
            enBtn.classList.toggle('active', lang === 'en');
            arBtn.classList.toggle('active', lang === 'ar');
            
            // æ›´æ–°é¡µé¢æ–‡æœ¬
            mainTitle.textContent = langConfig[lang].title;
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬ï¼ˆæ ¹æ®å½“å‰æ¨¡å¼ï¼‰
            if (isShuffleMode) {
                startBtn.textContent = langConfig[lang].shuffleBtn;
            } else {
                startBtn.textContent = langConfig[lang].startBtn;
            }
            
            // æ›´æ–°æ‰€æœ‰æ ¼å­çš„é—®å·
            document.querySelectorAll('.grid-item').forEach(item => {
                if (item.innerHTML.includes('ï¼Ÿ') || item.innerHTML.includes('?') || item.innerHTML.includes('ØŸ')) {
                    item.innerHTML = langConfig[lang].unknown;
                }
            });
            
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            if (lang === 'cn') {
                document.title = 'è¯•è¯•ä½ çš„è¿æ°” | å¹¸è¿å¤§æŠ½å¥–';
            } else if (lang === 'en') {
                document.title = 'Try Your Luck | Lucky Draw';
            } else if (lang === 'ar') {
                document.title = 'Ø¬Ø±Ø¨ Ø­Ø¸Ùƒ | Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø­Ø¸ÙŠ';
            }
        }
        
        // ç»‘å®šè¯­è¨€åˆ‡æ¢äº‹ä»¶
        cnBtn.addEventListener('click', () => switchLanguage('cn'));
        enBtn.addEventListener('click', () => switchLanguage('en'));
        arBtn.addEventListener('click', () => switchLanguage('ar'));

        // ========== åˆå§‹åŒ–å¥–å“æ˜ å°„ï¼ˆéšæœºåˆ†é…ï¼Œä»…ç”¨äºæ´—ç‰Œå±•ç¤ºï¼‰ ==========
        function initPrizeMap() {
            // å¤åˆ¶å¥–å“é…ç½®å¹¶æ‰“ä¹±é¡ºåº
            const shuffledPrizes = [...prizeConfig].sort(() => Math.random() - 0.5);
            // åˆ†é…ç»™16ä¸ªæ ¼å­
            for (let i = 1; i <= 16; i++) {
                gridPrizeMap[i] = shuffledPrizes[i - 1];
            }
        }

        // ========== æ¦‚ç‡æŠ½å¥–æ ¸å¿ƒå‡½æ•° ==========
        function getPrizeByProbability() {
            // åˆ›å»ºæ¦‚ç‡æ± 
            const prizePool = [];
            Object.entries(PRIZE_PROBABILITY).forEach(([prize, probability]) => {
                // æ ¹æ®æ¦‚ç‡ç™¾åˆ†æ¯”æ·»åŠ å¯¹åº”æ•°é‡çš„å¥–å“åˆ°æ± ä¸­
                for (let i = 0; i < probability; i++) {
                    prizePool.push(prize);
                }
            });
            
            // éšæœºæŠ½å–ä¸€ä¸ªå¥–å“
            const randomIndex = Math.floor(Math.random() * prizePool.length);
            let prize = prizePool[randomIndex];
            
            // æ ¹æ®å½“å‰è¯­è¨€è½¬æ¢å¥–å“åç§°
            prize = prizeMap[currentLang][prize] || prize;
            
            return prize;
        }

        // ========== å·¥å…·æ–¹æ³• ==========
        function getItemByNum(num) {
            return document.querySelector(`.grid-item[data-num="${num}"]`);
        }

        function flashElement(targetItem, times, interval) {
            return new Promise(resolve => {
                let flashCount = 0;
                const flashTimer = setInterval(() => {
                    targetItem.style.animation = flashCount % 2 === 0 
                        ? 'flashOnce 0.15s ease-out forwards'
                        : 'none';
                    flashCount++;
                    if (flashCount >= times * 2) {
                        clearInterval(flashTimer);
                        targetItem.style.animation = 'none';
                        resolve();
                    }
                }, interval);
            });
        }

        // è·å–å¥–å“å¯¹åº”çš„é¢œè‰²ç±»å
        function getPrizeColorClass(prize) {
            // ç»Ÿä¸€è½¬æ¢ä¸ºä¸­æ–‡åˆ¤æ–­
            let prizeCn = reversePrizeMap[prize] || prize;
            
            switch(prizeCn) {
                case 'è·å¾—100ç²‰ä¸': return 'color-black';
                case 'è·å¾—1000ç²‰ä¸': return 'color-yellow';
                case 'è·å¾—5000ç²‰ä¸': return 'color-orange';
                case 'è·å¾—10000ç²‰ä¸': return 'color-blue';
                case 'è·å¾—100000ç²‰ä¸': return 'color-red';
                default: return 'color-black';
            }
        }
        
        // ç”Ÿæˆå¥–å“HTML
        function generatePrizeHtml(prize) {
            let prizeTop = langConfig[currentLang].prizeTop;
            let prizeBottom = '';
            
            // æ ¹æ®å¥–å“ç±»å‹è®¾ç½®åº•éƒ¨æ–‡æœ¬
            if (currentLang === 'cn') {
                switch(prize) {
                    case 'è·å¾—100ç²‰ä¸': prizeBottom = langConfig[currentLang].prize100Bottom; break;
                    case 'è·å¾—1000ç²‰ä¸': prizeBottom = langConfig[currentLang].prize1000Bottom; break;
                    case 'è·å¾—5000ç²‰ä¸': prizeBottom = langConfig[currentLang].prize5000Bottom; break;
                    case 'è·å¾—10000ç²‰ä¸': prizeBottom = langConfig[currentLang].prize10000Bottom; break;
                    case 'è·å¾—100000ç²‰ä¸': prizeBottom = langConfig[currentLang].prize100000Bottom; break;
                }
            } else if (currentLang === 'en') {
                switch(prize) {
                    case 'Win 100 Fans': prizeBottom = langConfig[currentLang].prize100Bottom; break;
                    case 'Win 1000 Fans': prizeBottom = langConfig[currentLang].prize1000Bottom; break;
                    case 'Win 5000 Fans': prizeBottom = langConfig[currentLang].prize5000Bottom; break;
                    case 'Win 10000 Fans': prizeBottom = langConfig[currentLang].prize10000Bottom; break;
                    case 'Win 100000 Fans': prizeBottom = langConfig[currentLang].prize100000Bottom; break;
                }
            } else if (currentLang === 'ar') {
                switch(prize) {
                    case 'ÙÙˆØ² 100 Ù…ØªØ§Ø¨Ø¹': prizeBottom = langConfig[currentLang].prize100Bottom; break;
                    case 'ÙÙˆØ² 1000 Ù…ØªØ§Ø¨Ø¹': prizeBottom = langConfig[currentLang].prize1000Bottom; break;
                    case 'ÙÙˆØ² 5000 Ù…ØªØ§Ø¨Ø¹': prizeBottom = langConfig[currentLang].prize5000Bottom; break;
                    case 'ÙÙˆØ² 10000 Ù…ØªØ§Ø¨Ø¹': prizeBottom = langConfig[currentLang].prize10000Bottom; break;
                    case 'ÙÙˆØ² 100000 Ù…ØªØ§Ø¨Ø¹': prizeBottom = langConfig[currentLang].prize100000Bottom; break;
                }
            }
            
            return `
                <div class="prize-text">
                    <span class="prize-top">${prizeTop}</span>
                    <span class="prize-bottom">${prizeBottom}</span>
                </div>
            `;
        }

        // ========== âœ… æ´—ç‰ŒåŠŸèƒ½æ ¸å¿ƒé€»è¾‘ ==========
        async function shufflePrizes() {
            if (isRunning) return;
            isRunning = true;
            startBtn.disabled = true;

            // 1. é‡ç½®æ‰€æœ‰æ ¼å­æ ·å¼
            document.querySelectorAll('.grid-item').forEach(item => {
                item.classList.remove('active', 'win', 'flipped', 'color-black', 'color-yellow', 'color-orange', 'color-blue', 'color-red');
                item.style.animation = 'none';
            });

            // 2. é€ä¸ªç¿»å¼€æ ¼å­å±•ç¤ºå¥–å“ï¼ˆæ¨¡æ‹Ÿç¿»ç‰ŒåŠ¨ç”»ï¼‰
            const gridItems = document.querySelectorAll('.grid-item');
            for (let i = 0; i < gridItems.length; i++) {
                const item = gridItems[i];
                const num = item.dataset.num;
                let prize = gridPrizeMap[num];
                
                // æ ¹æ®å½“å‰è¯­è¨€è½¬æ¢å¥–å“åç§°
                prize = prizeMap[currentLang][prize] || prize;
                
                const colorClass = getPrizeColorClass(prize);
                
                // æ·»åŠ æ´—ç‰Œå±•ç¤ºæ ·å¼å’Œé¢œè‰²ç±»
                item.classList.add('shuffle-show', colorClass);
                // ç”Ÿæˆå¥–å“æ–‡å­—
                item.innerHTML = generatePrizeHtml(prize);
                
                // æ¯ä¸ªæ ¼å­ç¿»ç‰Œé—´éš”
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            // 3. å±•ç¤ºæŒ‡å®šæ—¶é•¿åç¿»å›é—®å·é¢
            await new Promise(resolve => setTimeout(resolve, SHOW_PRIZE_TIME));
            
            // 4. é€ä¸ªç¿»å›çº¢è‰²åº•é—®å·é¢
            for (let i = gridItems.length - 1; i >= 0; i--) {
                const item = gridItems[i];
                item.classList.remove('shuffle-show', 'color-black', 'color-yellow', 'color-orange', 'color-blue', 'color-red');
                item.innerHTML = langConfig[currentLang].unknown;
                await new Promise(resolve => setTimeout(resolve, 80));
            }

            // 5. é‡æ–°éšæœºåˆ†é…å¥–å“ï¼ˆä»…ç”¨äºæ´—ç‰Œå±•ç¤ºï¼‰
            initPrizeMap();

            // 6. æ¢å¤æŒ‰é’®çŠ¶æ€
            isShuffleMode = false;
            startBtn.textContent = langConfig[currentLang].startBtn;
            isRunning = false;
            startBtn.disabled = false;
        }

        // ========== âœ… æ ¸å¿ƒæŠ½å¥–é€»è¾‘ï¼ˆç²¾ç¡®æ¦‚ç‡æ§åˆ¶ï¼‰ ==========
        startBtn.addEventListener('click', async () => {
            // å¦‚æœæ˜¯æ´—ç‰Œæ¨¡å¼ï¼Œæ‰§è¡Œæ´—ç‰Œ
            if (isShuffleMode) {
                shufflePrizes();
                return;
            }

            // æ­£å¸¸æŠ½å¥–é€»è¾‘
            if (isRunning) return;
            isRunning = true;
            startBtn.disabled = true;

            // é‡ç½®æ‰€æœ‰æ ¼å­æ ·å¼
            document.querySelectorAll('.grid-item').forEach(item => {
                item.classList.remove('active', 'win', 'flipped', 'shuffle-show', 'color-black', 'color-yellow', 'color-orange', 'color-blue', 'color-red');
                item.style.animation = 'none';
                item.innerHTML = langConfig[currentLang].unknown;
            });

            // éšæœºæ»šåŠ¨æ—¶é•¿ï¼ˆ1000-1300msï¼‰
            const totalTime = 1000 + Math.floor(Math.random() * 301);
            const startTime = Date.now();
            let pathIndex = 0;
            let speed = 10; // åˆå§‹æ»šåŠ¨é€Ÿåº¦

            function run() {
                const now = Date.now();
                const passTime = now - startTime;
                const progress = passTime / totalTime;

                // ç§»é™¤ä¸Šä¸€ä¸ªæ ¼å­çš„é«˜äº®
                getItemByNum(luckyPath[pathIndex])?.classList.remove('active');
                // ç§»åŠ¨åˆ°è½¨è¿¹ä¸‹ä¸€ä¸ªæ ¼å­
                pathIndex = (pathIndex + 1) % luckyPath.length;
                const currNum = luckyPath[pathIndex];
                const currItem = getItemByNum(currNum);
                // æ·»åŠ å½“å‰æ ¼å­çš„é«˜äº®
                currItem?.classList.add('active');

                // æ»šåŠ¨é€Ÿåº¦éšè¿›åº¦å˜æ…¢
                speed = 10 + progress * 110;

                // æ»šåŠ¨ç»“æŸå¼€å¥–
                if (passTime >= totalTime) {
                    document.querySelectorAll('.grid-item').forEach(item => item.classList.remove('active'));
                    currItem.classList.add('win');
                    
                    // ========== âœ… å…³é”®ä¿®æ”¹ï¼šä½¿ç”¨æ¦‚ç‡å‡½æ•°è·å–ä¸­å¥–å¥–å“ ==========
                    const winPrize = getPrizeByProbability();
                    
                    // é—ªçƒåŠ¨ç”»åç¿»è½¬æ˜¾ç¤ºå¥–å“
                    flashElement(currItem, FLASH_TIMES, FLASH_INTERVAL).then(() => {
                        currItem.classList.remove('win');
                        currItem.classList.add('flipped');
                        // è·å–å¥–å“é¢œè‰²ç±»
                        const colorClass = getPrizeColorClass(winPrize);
                        currItem.classList.add(colorClass);
                        // ç”Ÿæˆå¥–å“æ–‡å­—
                        currItem.innerHTML = generatePrizeHtml(winPrize);
                        
                        // ========== âœ… å·²åˆ é™¤ï¼šä¸­å¥–ç»“æœå¼¹çª—æç¤º ==========
                        // alert(`ğŸ‰ æ­å–œä½ ï¼${winPrize} ğŸ‰`);
                        
                        // åˆ‡æ¢ä¸ºæ´—ç‰Œæ¨¡å¼
                        isShuffleMode = true;
                        startBtn.textContent = langConfig[currentLang].shuffleBtn;
                        
                        // è§£é”çŠ¶æ€
                        isRunning = false;
                        startBtn.disabled = false;
                    });
                    return;
                }
                // ç»§ç»­æ»šåŠ¨
                setTimeout(() => requestAnimationFrame(run), speed);
            }
            // å¯åŠ¨æ»šåŠ¨
            run();
        });

        // ========== è°ƒè¯•å¿«æ·å…¥å£ ==========
        window.clearRecord = function() {
            alert(langConfig[currentLang].clearRecordAlert);
        }

        // ========== æ¦‚ç‡éªŒè¯å·¥å…·ï¼ˆæ›´æ–°ä¸ºéªŒè¯è‡ªå®šä¹‰æ¦‚ç‡ï¼‰ ==========
        window.checkProbability = function(times = 10000) {
            const result = {
                "è·å¾—100ç²‰ä¸": 0,
                "è·å¾—1000ç²‰ä¸": 0,
                "è·å¾—5000ç²‰ä¸": 0,
                "è·å¾—10000ç²‰ä¸": 0,
                "è·å¾—100000ç²‰ä¸": 0
            };
            
            for(let i=0; i<times; i++) {
                let prize = getPrizeByProbability();
                // ç»Ÿä¸€è½¬æ¢ä¸ºä¸­æ–‡ç»Ÿè®¡
                prize = reversePrizeMap[prize] || prize;
                result[prize]++;
            }
            
            console.log(`${langConfig[currentLang].checkProbabilityLog1}${times}${langConfig[currentLang].checkProbabilityLog2}`);
            console.log(`100${langConfig[currentLang].checkProbabilityLog3}${result["è·å¾—100ç²‰ä¸"]}${langConfig[currentLang].checkProbabilityLog4}${(result["è·å¾—100ç²‰ä¸"]/times*100).toFixed(2)}%)`);
            console.log(`1000${langConfig[currentLang].checkProbabilityLog3}${result["è·å¾—1000ç²‰ä¸"]}${langConfig[currentLang].checkProbabilityLog4}${(result["è·å¾—1000ç²‰ä¸"]/times*100).toFixed(2)}%)`);
            console.log(`5000${langConfig[currentLang].checkProbabilityLog3}${result["è·å¾—5000ç²‰ä¸"]}${langConfig[currentLang].checkProbabilityLog4}${(result["è·å¾—5000ç²‰ä¸"]/times*100).toFixed(2)}%)`);
            console.log(`10000${langConfig[currentLang].checkProbabilityLog3}${result["è·å¾—10000ç²‰ä¸"]}${langConfig[currentLang].checkProbabilityLog4}${(result["è·å¾—10000ç²‰ä¸"]/times*100).toFixed(2)}%)`);
            console.log(`100000${langConfig[currentLang].checkProbabilityLog3}${result["è·å¾—100000ç²‰ä¸"]}${langConfig[currentLang].checkProbabilityLog4}${(result["è·å¾—100000ç²‰ä¸"]/times*100).toFixed(2)}%)`);
            alert(langConfig[currentLang].checkProbabilityAlert);
        }
    </script>
</body>
</html>